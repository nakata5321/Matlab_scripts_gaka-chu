%old
%x = [805.3 925.59 1047.53 1043.53 845.26 771.86 651.98 651.98 745.56 903.65 1037.61 594.77]/1000;
%y = [0.06 0 0 -283.19 -283.19 -283.19 -283.19 -217.55 -217.55 -217.55 -217.55 46.26]/1000;
%z = [248.61 250.28 251.0 251.0 251.0 250.01 248.64 247.18 248.47 250.92 251.2 248.27]/1000;

% x = ([570.18 570.19 670.18 754.66 754.64 641.35 535.33 400.68 400.65 517.29 697.99 697.98 315.19 482.02 482.04 637.44 753.04 352.21 352.15 ] + 280)/1000
% y = [-90.908 161.77 161.76 161.75 44.68 44.62 44.63 44.64 -176.47 -176.48 -176.5 -269.6 -269.56 -269.58 -36.19 -100.29 175.86 147.27 -336.65 ]/1000
% z = [235.1 235.03 236.6 236.6 237.42 236.54 236.54 236.56 234.97 236.09 237.72 237.73 235.29 236.21 236.18 237.11 237.08 237.09 235.9 ]/1000
% N = 19;

x = [950.79 950.75 884.32 756.91 707.28 672.76 948.31 997.42 908.68 812.14 812.1 934.41 825.88 733.53 650.99 642.35 729.15 638.86 778.24]/1000;
y = [-0.87 -172.49 -132.21 -324.32 -179.21 112.21 118.83 145.38 47.36 94.77 -108.73 -232.84 -233 -153.63 -68.38 4.92 75.91 151.99 177.47]/1000;
z = [238.19 238.2 238.69 241.94 242.16 245.3 239.59 239.33 239.6 240.57 241.41 240.04 240.84 241.91 244.72 244.81 242.5 245.44 244.23]/1000;
%%
%смещение по х на -270 мм

xs = sum(x)/length(x);
ys = sum(y)/length(x);
zs = sum(z)/length(x);
for i=1:length(x)
xx = x(i) - xs;
yy = y(i) - ys;
zz = z(i) - zs;
M(i,:) = [xx, yy, zz];
end

A = M'*M;
[s,v,d] = svd(A);

eul = rotm2eul(d);

yaw = eul(1);
pitch = eul(2);
roll = eul(3);  

cy = cos(yaw * 0.5);
sy = sin(yaw * 0.5);
cp = cos(pitch * 0.5);
sp = sin(pitch * 0.5);
cr = cos(roll * 0.5);
sr = sin(roll * 0.5);

qw = cr * cp * cy + sr * sp * sy
qx = sr * cp * cy - cr * sp * sy
qy = cr * sp * cy + sr * cp * sy
qz = cr * cp * sy - sr * sp * cy

%%
%rotation
rotate_angle  = 88;
w = cosd(rotate_angle  / 2);
x = 0 * sind(rotate_angle / 2);
y = 0 * sind(rotate_angle / 2);
z = 1 * sind(rotate_angle / 2);



res_x = qw * x + qx * w + qy * z - qz * y
res_y = qw * y - qx * z + qy * w + qz * x
res_z = qw * z + qx * y - qy * x + qz * w
res_w = qw * w - qx * x - qy * y - qz * z
